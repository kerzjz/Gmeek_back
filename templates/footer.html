  <link rel="stylesheet" href="https://unpkg.com/mdui@1/dist/css/mdui.min.css"/>
  <style>
    #currentUrl {
      margin-top: 12px;
      font-size: 12px;
      color: #666;
      word-break: break-all;
    }
  </style>
<base target="_blank">
</head>
<body>
  <div class="mdui-container">
    <div class="mdui-panel" mdui-panel>
      <div class="mdui-panel-item" id="sharePanel">
        <div class="mdui-panel-item-header">分享</div>
        <div class="mdui-panel-item-body">
          <div id="qrcode" style="display: inline-block; margin: 20px auto;"></div>
          <div id="currentUrl"></div>
          <br/>
          <button id="copyButton" class="mdui-btn mdui-btn-raised mdui-ripple">复制页面网址</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
  <script src="https://unpkg.com/mdui@1/dist/js/mdui.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const copyButton = document.getElementById('copyButton');
      const panel = document.getElementById('sharePanel');

      /* 复制功能 */
      copyButton.addEventListener('click', () => {
        const url = window.location.href;
        navigator.clipboard.writeText(url)
          .then(() => alert('页面网址已复制到剪贴板！'))
          .catch(err => {
            console.error(err);
            alert('复制失败，请手动复制网址。');
          });
      });

      /* 面板展开后生成二维码（MDUI 提供的事件） */
      panel.addEventListener('open.mdui.panel', () => {
        if (!document.querySelector('#qrcode canvas')) {
          generateQRCode();
        }
      });
    });

    function generateQRCode() {
      const container = document.getElementById('qrcode');
      const url = window.location.href;
      container.innerHTML = '';
      document.getElementById('currentUrl').textContent = url;

      new QRCode(container, {
        text: url,
        width: 200,
        height: 200,
        colorDark: '#000',
        colorLight: '#fff',
        correctLevel: QRCode.CorrectLevel.H
      });
    }
  </script>
    
<div id="footer1">Copyright © <span id="copyrightYear"></span> <a href="{{ blogBase['homeUrl'] }}">{{ blogBase['title'] }}</a></div>
<div id="footer2">
    
    {%- if blogBase['filingNum']!='' -%}
    <span id="filingNum"><a href="https://icp.gov.moe/" target="_blank">{{ blogBase['filingNum'] }}</a> • </span>
    {%- endif %}
    <span id="runday"></span><span>Powered by <a href="https://meekdai.com/Gmeek.html" target="_blank">Gmeek</a></span>
</div>

<script>
var now=new Date();
document.getElementById("copyrightYear").innerHTML=now.getFullYear();

if("{{ blogBase['startSite'] }}"!=""){
    var startSite=new Date("{{ blogBase['startSite'] }}");
    var diff=now.getTime()-startSite.getTime();
    var diffDay=Math.floor(diff/(1000*60*60*24));
    document.getElementById("runday").innerHTML="{{ i18n['run'] }}"+diffDay+"{{ i18n['days'] }}"+" • ";
}
</script>
